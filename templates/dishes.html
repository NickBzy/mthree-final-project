<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../static/css/styles.css">
    <title>Dishes</title>
</head>
<body>
    <div class="wrapper">
         <nav>
            <h2><a href="/">Foodies</a></h2>
            <ul>
                <li><a href="/">Home</a></li>
                <li><a href="/restaurants">Restaurants</a></li>
                <li><a href="/dishes">Dishes</a></li>
                <li><a href="/reservations">Reservations</a></li>
                <!-- <li><a href="/dishes/add">Add dishes</a></li> -->
            </ul>
            <ul>
                <!-- <button>Sign in</button> -->
            </ul>
        </nav>  
        <main>
            <div class="head-list">
                <div class="filters">
                    <form method="get" action="/dishes" id="filterForm">
                        <label for="cities">Filter by City:</label>
                        <select name="city" id="cities" multiple>
                            {% for city in all_cities %}
                                <option value="{{ city }}" {% if city in selected_cities %}selected{% endif %}>{{ city }}</option>
                            {% endfor %}
                        </select>

                        <input type="hidden" name="order" value="{{ order }}">
                        <button type="submit">Apply Filters</button>
                    </form>

                    <form method="get" action="/dishes" style="display:inline;">
                        {% for city in selected_cities %}
                            <input type="hidden" name="city" value="{{ city }}">
                        {% endfor %}
                        <input type="hidden" name="order_by_orders" value="{% if order_by_orders == 'desc' %}asc{% else %}desc{% endif %}">
                        <button type="submit">
                            Sort by Orders {% if order_by_orders == 'desc' %}↓{% else %}↑{% endif %}
                        </button>
                    </form>
                </div>
                <button class="add">Add Dish</button>
            </div>
            {% if resto_id %}
            <a href="{{ url_for('reserve_resto', rest_id=resto_id) }}">
                <h2 class="dishes-header">Make reservation</h2>
            </a>
            {% endif %}
            
            {% if city %}
            <h2 class="dishes-header">Dishes in {{ city }}</h2>
            {% else %}
            <h2 class="dishes-header">All Dishes</h2>
            {% endif %}
            <div class="trending-dishes">
                <div class="dishes-list">
                    {% for dish in dishes %}
                    <div class="dish-item">
                        <div class="dish-item-bottom">
                            <h3>{{ dish[1] }}</h3>
                            <h3><span class="from">FROM </span>{{ dish[3] }}</h3>
                            <p>Ordered <span>{{ dish[2] }}</span> times</p>
                            <div class="location">
                                <p><span> {{ dish[4] }}, </span> <span> {{ dish[5] }} </span></p>
                            </div>
                        </div>
                        <a href="{{ url_for('remove_menu_item', item_id=dish[0]) }}">Delete </a>
                    </div>
                    {% endfor %}
                </div>
                
            </div>

            <div class="add-overlay">
                <form action="/add_dish" method="post" class="add-dish-form">
                    
                    <label for="restaurant">Restaurant:</label>
                    <select id="restaurant" name="restaurant_id" required>
                        <option value="">Select Restaurant</option>
                        {% for r_id, r_name in restaurants %}
                            <option value="{{ r_id }}">{{ r_name }}</option>
                        {% endfor %}
                    </select>

                    <label for="menu">Menu:</label>
                    <select id="menu" name="menu_id" required>
                        <option value="">Select Menu</option>
                    </select>

                    <label for="dish-name">Dish Name:</label>
                    <input type="text" id="dish-name" name="dish_name" required>

                    <label for="price">Price:</label>
                    <input type="number" id="price" name="price" step="0.01" required>

                    <button type="submit">Add Dish</button>
                </form>
            </div>

            <script>
            document.getElementById("restaurant").addEventListener("change", function() {
                let restaurantId = this.value;
                let menuSelect = document.getElementById("menu");
                menuSelect.innerHTML = '<option value="">Loading...</option>';

                if (restaurantId) {
                    fetch(`/get_menus/${restaurantId}`)
                        .then(response => response.json())
                        .then(data => {
                            menuSelect.innerHTML = '<option value="">Select Menu</option>';
                            data.forEach(menu => {
                                let option = document.createElement("option");
                                option.value = menu[0];
                                option.textContent = menu[1];
                                menuSelect.appendChild(option);
                            });
                        });
                } else {
                    menuSelect.innerHTML = '<option value="">Select Menu</option>';
                }
            });
            document.addEventListener("DOMContentLoaded", () => {
                const overlay = document.querySelector(".add-overlay");
                const addBtn = document.querySelector(".add");

                addBtn.addEventListener("click", () => {
                    overlay.classList.add("active");
                });

                // Close overlay when clicking outside form
                overlay.addEventListener("click", (e) => {
                    if (e.target === overlay) {
                        overlay.classList.remove("active");
                    }
                });
            });
            </script>

        </main>
         <footer>
            <p>© 2025 Foodies. All rights reserved.</p>
        </footer>
    </div>
</body>
</html>