<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../static/css/styles.css">
    <title>Restaurants</title>
</head>
<body>
    <div class="wrapper">
         <nav>
            <h2>Foodies</h2>
            <ul>
                <li><a href="/">Home</a></li>
                <li><a href="/restaurants">Restaurants</a></li>
                <li><a href="/dishes">Dishes</a></li>
                <li><a href="/reservations">Reservations</a></li>
            </ul>
            <ul>
                <button>Sign in</button>
            </ul>
        </nav>  
        <main>
            <div class="head-list">
                <div class="filters">
                    <form method="get" action="/restaurants" id="filterForm">
                        <label for="cities">Filter by City:</label>
                        <select name="city" id="cities" multiple>
                            {% for city in all_cities %}
                                <option value="{{ city }}" {% if city in selected_cities %}selected{% endif %}>{{ city }}</option>
                            {% endfor %}
                        </select>

                        <input type="hidden" name="order" value="{{ order }}">
                        <button type="submit">Apply Filters</button>
                    </form>

                    <!-- Toggle Reservation Order -->
                    <form method="get" action="/restaurants" style="display:inline;">
                        {% for city in selected_cities %}
                            <input type="hidden" name="city" value="{{ city }}">
                        {% endfor %}
                        <input type="hidden" name="order" value="{% if order == 'desc' %}asc{% else %}desc{% endif %}">
                        <button type="submit">
                            Sort by Reservations {% if order == 'desc' %}↓{% else %}↑{% endif %}
                        </button>
                    </form>
                </div>
                <button class="add">Add Restaurant</button>
            </div>
            
            
            {% if city %}
            <h2 class="restaurant-header">Restaurants in {{ city }}</h2>
            {% else %}
            <h2 class="restaurant-header">All Restaurants</h2>
            {% endif %}
            <div class="featured-restaurants">
                <div class="restaurants-list">
                    {% for restaurant in restaurant %}
                    <div class="restaurant-item">
                        <div class="restaurant-item-list">
                            <h3>{{ restaurant[1] }}</h3>
                            <div class="rating">
                                <div class="stars">
                                    <div class="star"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><title>star</title><path d="M12,17.27L18.18,21L16.54,13.97L22,9.24L14.81,8.62L12,2L9.19,8.62L2,9.24L7.45,13.97L5.82,21L12,17.27Z" /></svg></div>
                                    <div class="star"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><title>star</title><path d="M12,17.27L18.18,21L16.54,13.97L22,9.24L14.81,8.62L12,2L9.19,8.62L2,9.24L7.45,13.97L5.82,21L12,17.27Z" /></svg></div>
                                    <div class="star"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><title>star</title><path d="M12,17.27L18.18,21L16.54,13.97L22,9.24L14.81,8.62L12,2L9.19,8.62L2,9.24L7.45,13.97L5.82,21L12,17.27Z" /></svg></div>
                                    <div class="star"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><title>star</title><path d="M12,17.27L18.18,21L16.54,13.97L22,9.24L14.81,8.62L12,2L9.19,8.62L2,9.24L7.45,13.97L5.82,21L12,17.27Z" /></svg></div>
                                    <div class="star"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><title>star</title><path d="M12,17.27L18.18,21L16.54,13.97L22,9.24L14.81,8.62L12,2L9.19,8.62L2,9.24L7.45,13.97L5.82,21L12,17.27Z" /></svg></div>
                                </div>
                                <p class="rating-count">0</p>
                            </div>
                            <div class="reservations-count">
                                <p>{{ restaurant[3] }} reservations</p>
                            </div>
                            <div class="location">
                                <p><span>{{ restaurant[5] }}, </span><span>{{ restaurant[4] }}</span></p>
                            </div>
                            <div class="restaurant-info">
                                <p class="cuisine">{{ restaurant[2] }}</p>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>  
            </div>

           <div class="add-overlay">
                <form action="/add_restaurant" method="POST" class="add-restaurant-form">
                    <h2>Add a New Restaurant</h2>

                    <!-- Restaurant Name -->
                    <label for="name">Restaurant Name:</label>
                    <input type="text" id="name" name="name" placeholder="Enter restaurant name" required>

                    <!-- Cuisine -->
                    <label for="cuisine">Cuisine:</label>
                    <input type="text" id="cuisine" name="cuisine" placeholder="e.g. Italian, Sushi, Mexican" required>

                    <!-- Province Dropdown -->
                    <label for="province">Province:</label>
                    <select id="province" name="province" required>
                        <option value="">-- Select Province --</option>
                        {% for province in provinces %}
                            <option value="{{ province }}">{{ province }}</option>
                        {% endfor %}
                    </select>

                    <!-- City Dropdown -->
                    <label for="city">City:</label>
                    <select id="city" name="city" required>
                        <option value="">-- Select City --</option>
                    </select>

                    <!-- Submit -->
                    <button type="submit">Add Restaurant</button>
                </form>
            </div>

            <script>
            document.getElementById("province").addEventListener("change", function() {
                let province = this.value;
                let citySelect = document.getElementById("city");

                // Clear current options
                citySelect.innerHTML = '<option value="">-- Select City --</option>';

                if (province) {
                    fetch(`/get_cities?province=${encodeURIComponent(province)}`)
                        .then(response => response.json())
                        .then(data => {
                            data.forEach(city => {
                                let option = document.createElement("option");
                                option.value = city;
                                option.textContent = city;
                                citySelect.appendChild(option);
                            });
                        });
                }
            });
            document.addEventListener("DOMContentLoaded", () => {
                const overlay = document.querySelector(".add-overlay");
                const addBtn = document.querySelector(".add");

                addBtn.addEventListener("click", () => {
                    overlay.classList.add("active");
                });

                // Close overlay when clicking outside form
                overlay.addEventListener("click", (e) => {
                    if (e.target === overlay) {
                        overlay.classList.remove("active");
                    }
                });
            });
            </script>

        </main>
         <footer>
            <p>© 2025 Foodies. All rights reserved.</p>
        </footer>
    </div>
</body>
</html>